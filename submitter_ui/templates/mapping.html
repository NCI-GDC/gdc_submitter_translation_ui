
{% extends 'layout.html' %}

{% block body %}
<div class="jumbotron text-left">
  <form action="{{ url_for('output', snode=selected_node) }}" method="POST">
    <table class="table table-sm" id="mappingTable">
      <tr>
        <th>Required for <code>{{ selected_node }}</code> :</th>
        <th>Header from your input</th>
        <th>Choose default value</th>
      </tr>
      {% if required_list %}
      {% for rk in required_list %}
      <tr>
          <td class="align-middle"><label for="{{ rk }}"><kbd>{{ rk }}</kbd></label></td>
          <td>
            <div class="form-group">
              <select name="{{ rk }}" class="form-control">
                <option value="not_defined">not_defined</option>
                {% set fieldList = header.split('\t') %}
                {% for field in fieldList %}
                <option value="{{ field }}">{{ field }}</option>
                {% endfor %}
              </select>
            </div>
          </td>
          <td>
            <div class="form-group">
              {% for key, value in enum.items() %}
                {% if rk == key %}
                  <select class="form-control" name="default_{{ rk }}">
                    <option value="not_defined">not_defined</option>
                    {% for v in value %}
                    <option value="{{ v }}">{{ v }}</option>
                    {% endfor %}
                  </select>
                {% endif %}
              {% endfor %}
            </div>
          </td>
      </tr>
      {% endfor %}
      {% else %}
      {% endif %}
      {% if optional_list %}
      <tr>
        <th>Optional for <code>{{ selected_node }}</code> :</th>
        <th></th>
        <th></th>
      </tr>
      {% for ok in optional_list %}
      <tr>
          <td class="align-middle"><label for="{{ ok }}"><kbd>{{ ok }}</kbd></label></td>
          <td>
            <div class="form-group">
              <select name="{{ ok }}" class="form-control">
                <option value="not_defined">not_defined</option>
                {% set fieldList = header.split('\t') %}
                {% for field in fieldList %}
                <option value="{{ field }}">{{ field }}</option>
                {% endfor %}
              </select>
            </div>
          </td>
          <td>
            <div class="form-group">
              {% for key, value in enum.items() %}
                {% if ok == key %}
                  <select class="form-control" name="default_{{ ok }}">
                    <option value="not_defined">not_defined</option>
                    {% for v in value %}
                    <option value="{{ v }}">{{ v }}</option>
                    {% endfor %}
                  </select>
                {% endif %}
              {% endfor %}
            </div>
          </td>
          <td><input type="button" value="Delete" onclick="deleteRow(this)" class="btn btn-danger"></td>
      </tr>
      {% endfor %}
      {% else %}
      {% endif %}
      {% if exclusive_list %}
      <tr>
        <th>Exclusive links for <code>{{ selected_node }}</code> :</th>
        <th></th>
        <th></th>
      </tr>
      {% for ek in exclusive_list %}
      <tr>
          <td>
            <div class="form-group">
              <select name="link_exclusive_field_{{ loop.index }}" class="form-control">
                {% for field in ek %}
                <option value="{{ field }}">{{ field }}</option>
                {% endfor %}
              </select>
          </td>
          <td>
            <div class="form-group">
              <select name="link_exclusive_chosen_{{ loop.index }}" class="form-control">
                <option value="not_defined">not_defined</option>
                {% set fieldList = header.split('\t') %}
                {% for field in fieldList %}
                <option value="{{ field }}">{{ field }}</option>
                {% endfor %}
              </select>
            </div>
          </td>
          <td>
            <div class="form-group">
              {% for key, value in enum.items() %}
                {% if ek == key %}
                  <select class="form-control" name="default_{{ ek }}">
                    <option value="not_defined">not_defined</option>
                    {% for v in value %}
                    <option value="{{ v }}">{{ v }}</option>
                    {% endfor %}
                  </select>
                {% endif %}
              {% endfor %}
            </div>
          </td>
          <td><input type="button" value="Delete" onclick="deleteRow(this)" class="btn btn-danger"></td>
      </tr>
      {% endfor %}
      {% elif inexclusive_list %}
      <tr>
        <th>Links for <code>{{ selected_node }}</code> :</th>
        <th></th>
        <th></th>
      </tr>
      {% for ik in inexclusive_list %}
      <tr>
          <td class="align-middle"><label for="link_{{ ik }}"><kbd>{{ ik }}</kbd></label></td>
          <td>
            <div class="form-group">
              <select name="link_{{ ik }}" class="form-control">
                <option value="not_defined">not_defined</option>
                {% set fieldList = header.split('\t') %}
                {% for field in fieldList %}
                <option value="{{ field }}">{{ field }}</option>
                {% endfor %}
              </select>
            </div>
          </td>
          <td>
            <div class="form-group">
              {% for key, value in enum.items() %}
                {% if ik == key %}
                  <select class="form-control" name="default_{{ ik }}">
                    <option value="not_defined">not_defined</option>
                    {% for v in value %}
                    <option value="{{ v }}">{{ v }}</option>
                    {% endfor %}
                  </select>
                {% endif %}
              {% endfor %}
            </div>
          </td>
          <td><input type="button" value="Delete" onclick="deleteRow(this)" class="btn btn-danger"></td>
      </tr>
      {% endfor %}
      {% elif link_list %}
      <tr>
        <th>Links for <code>{{ selected_node }}</code> :</th>
        <th></th>
        <th></th>
      </tr>
      {% for lk in link_list %}
      <tr>
          <td class="align-middle"><label for="link_{{ lk }}"><kbd>{{ lk }}</kbd></label></td>
          <td>
            <div class="form-group">
              <select name="link_{{ lk }}" class="form-control">
                <option value="not_defined">not_defined</option>
                {% set fieldList = header.split('\t') %}
                {% for field in fieldList %}
                <option value="{{ field }}">{{ field }}</option>
                {% endfor %}
              </select>
            </div>
          </td>
          <td>
            <div class="form-group">
              {% for key, value in enum.items() %}
                {% if lk == key %}
                  <select class="form-control" name="default_{{ lk }}">
                    <option value="not_defined">not_defined</option>
                    {% for v in value %}
                    <option value="{{ v }}">{{ v }}</option>
                    {% endfor %}
                  </select>
                {% endif %}
              {% endfor %}
            </div>
          </td>
          <td><input type="button" value="Delete" onclick="deleteRow(this)" class="btn btn-danger"></td>
      </tr>
      {% endfor %}
      {% else %}
      {% endif %}
      <tr>
        <th>Config options:</th>
        <th>ID type</th>
        <th></th>
      </tr>
      <tr>
          <td class="align-middle"><label for="link_id_type"><kbd>link_id_type</kbd></label></td>
          <td>
            <div class="form-group">
              <select name="link_id_type" class="form-control">
                <option value="id">id</option>
                <option value="submitter_id">submitter_id</option>
              </select>
            </div>
          </td>
          <td></td>
      </tr>
      <tr style="display:none" id="tbd_header">
        <th>Required for <code>to_be_deleted.yaml</code> </th>
        <th>Selections</th>
        <th></th>
      </tr>
      <tr style="display:none" id="tbd_id_type">
        <td class="align-middle"><label for="tbd_id_type"><kbd>id_type</kbd></label></td>
        <td>
          <div class="form-group">
            <select name="tbd_id_type" class="form-control">
              <option disabled value="" selected>...</option>
              <option value="id">id</option>
              <option value="submitter_id">submitter_id</option>
            </select>
          </div>
        </td>
        <td></td>
      </tr>
      <tr style="display:none" id="tbd_source_field">
        <td class="align-middle"><label for="tbd_source_field"><kbd>source_field</kbd></label></td>
        <td>
          <div class="form-group">
            <select name="tbd_source_field" class="form-control">
              <option disabled value="" selected>...</option>
              <option value="not_defined">not_defined</option>
              {% set fieldList = header.split('\t') %}
              {% for field in fieldList %}
              <option value="{{ field }}">{{ field }}</option>
              {% endfor %}
            </select>
          </div>
        </td>
        <td></td>
      </tr>
    </table>
    <input type="checkbox" id="myCheck" onclick="checkdisplay()"> Create "to_be_deleted.yaml"</input>
    <br>
    <br>
    <input type="submit" value="Map" class="btn btn-outline-info">
  </form>
</div>
<br>
<br>
<div class="btn-group btn-group-justified fixed-bottom">
  <a href="/upload" class="btn btn-outline-success">Select & Upload</a>
  <button type="button" class="btn btn-info btn-block">Select & Map</button>
  <button type="button" class="btn btn-outline-primary" disabled>Check & Download</button>
</div>
<script>
function deleteRow(r) {
    var i = r.parentNode.parentNode.rowIndex;
    document.getElementById("mappingTable").deleteRow(i);
}
function checkdisplay() {
    var checkBox = document.getElementById("myCheck");
    var Row0 = document.getElementById("tbd_header")
    var Row1 = document.getElementById("tbd_id_type");
    var Row2 = document.getElementById("tbd_source_field");
    if (checkBox.checked == true){
        Row0.style.display = "table-row";
        Row1.style.display = "table-row";
        Row2.style.display = "table-row";
    } else {
       Row0.style.display = "none";
       Row1.style.display = "none";
       Row2.style.display = "none";
    }
}
</script>
{% endblock %}
